<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>極永遠の闇：内外判定</title>
  <style>
    :root { --bg:#e6edf3; --fg:#222; --accent:#444; --muted:#555; --inner:#0f766e; --outer:#b45309; --inner-bg:#b2f5e9; --outer-bg:#ffe8b3; }
    body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;padding:14px;max-width:760px;margin:auto}
    .title{font-size:20px;font-weight:800;margin:4px 0 12px}
    .card{background:#f9fafb;border:1px solid #bbb;border-radius:12px;padding:12px;margin:8px 0;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .label-small{font-size:12px;color:var(--muted);margin-bottom:4px}
    .grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .btn{display:flex;align-items:center;justify-content:center;min-height:60px;background:#f0f1f3;border:2px solid #ccc;border-radius:10px;cursor:pointer;font-weight:800;font-size:18px;color:var(--fg)}
    .btn:hover{border-color:var(--accent);background:#e3e5e8}
    .sel{border-color:var(--accent)!important;background:#d5d7da!important;color:var(--accent)}
    .result-big{font-size:56px;font-weight:900;padding:10px 14px;border-radius:14px;border:3px solid var(--accent);display:inline-block;margin:4px;vertical-align:middle;background:#fff}
    .seg span{display:inline-block;border-radius:8px;padding:4px 8px;margin:0 1px;font-weight:900}
    .seg .inner{color:var(--inner);background:var(--inner-bg)}
    .seg .outer{color:var(--outer);background:var(--outer-bg)}
    .badge{display:inline-flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;min-width:120px;padding:10px 16px;border-radius:12px;border:2px solid var(--accent);margin-left:12px;background:var(--accent);color:#fff}
    .muted{color:var(--muted);font-size:14px;margin-top:8px}
    .toolbar{display:flex;gap:8px;margin-top:8px;justify-content:center}
    .mini{font-size:14px;padding:6px 10px;border-radius:8px;background:#f0f1f3;border:1px solid #ccc;cursor:pointer}
    .mini:hover{background:#e3e5e8}
    .seq-label span{display:inline-block;border-radius:6px;padding:2px 6px;margin:0 1px;font-weight:900}
    .seq-label .inner{color:var(--inner);background:var(--inner-bg)}
    .seq-label .outer{color:var(--outer);background:var(--outer-bg)}
  </style>
</head>
<body>
  <div class="title">極永遠の闇：内外判定</div>

  <div class="card">
    <div class="label-small">内外選択</div>
    <div class="grid4" id="seqTiles"></div>
  </div>

  <div class="card">
    <div class="label-small">開始番号</div>
    <div class="grid4">
      <button class="btn" data-start="1">1</button>
      <button class="btn" data-start="2">2</button>
      <button class="btn" data-start="3">3</button>
      <button class="btn" data-start="4">4</button>
    </div>
  </div>

  <div class="card">
    <div class="label-small">散開選択</div>
    <div class="row2">
      <button class="btn" id="btnDouble">4:4 / 二重</button>
      <button class="btn" id="btnQuad">ペア / 四重</button>
    </div>
  </div>

  <div class="card" style="text-align:center">
    <div class="seg" style="display:inline-block">
      <span id="resSeq" class="result-big">—</span>
    </div>
    <span id="resType" class="badge">—</span>
    <div id="resSub" class="muted"></div>
    <div class="toolbar">
      <button class="mini" id="reset">リセット</button>
      <button class="mini" id="copy">コピー</button>
    </div>
  </div>

  <script>
    const $ = q=>document.querySelector(q);
    const $$ = q=>Array.from(document.querySelectorAll(q));
    const SEQUENCES = [
      { id:'S1', label:['内','外','外','内'], arr:['内','外','外','内'] },
      { id:'S2', label:['外','内','外','内'], arr:['外','内','外','内'] },
      { id:'S3', label:['内','内','外','外'], arr:['内','内','外','外'] },
      { id:'S4', label:['外','外','内','内'], arr:['外','外','内','内'] },
    ];
    let state = { seq:null, start:null, wave:null };

    const seqGrid = $('#seqTiles');
    SEQUENCES.forEach(s=>{
      const b = document.createElement('button');
      b.className = 'btn';
      b.innerHTML = `<div class="seq-label">${wrapSeq(s.label)}</div>`;
      b.addEventListener('click', ()=>{ state.seq = s; highlight(); render(); });
      seqGrid.appendChild(b);
    });

    $$('.card .grid4 button[data-start]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ state.start = parseInt(btn.dataset.start); highlight(); render(); });
    });

    $('#btnDouble').addEventListener('click', ()=>{ state.wave='4:4 / 二重'; render(); });
    $('#btnQuad').addEventListener('click', ()=>{ state.wave='ペア / 四重'; render(); });

    function highlight(){
      $$('#seqTiles .btn').forEach((el,i)=>{
        el.classList.toggle('sel', state.seq && SEQUENCES[i].id===state.seq.id);
      });
      $$('.card .grid4 button[data-start]').forEach(el=>{
        el.classList.toggle('sel', state.start && parseInt(el.dataset.start)===state.start);
      });
    }

    function rotate(arr,k){ const n = arr.length; const kk = ((k%n)+n)%n; return arr.slice(kk).concat(arr.slice(0,kk)); }

    function wrapSeq(arr){ return arr.map(ch=>`<span class="${ch==='内'?'inner':'outer'}">${ch}</span>`).join(''); }

    function render(){
      const ready = state.seq && state.start;
      if(ready){
        const rot = rotate(state.seq.arr, state.start-1);
        $('#resSeq').innerHTML = wrapSeq(rot);
        $('#resSub').textContent = `${state.seq.label.join('')} / start:${state.start} → ${rot.join('')}`;
      } else {
        $('#resSeq').textContent = '—';
        $('#resSub').textContent = '';
      }
      $('#resType').textContent = state.wave || '—';
    }

    $('#copy').addEventListener('click', ()=>{
      navigator.clipboard.writeText(`${$('#resSeq').innerText.replace(/\s+/g,'')} ${$('#resType').textContent}`.trim());
    });
    $('#reset').addEventListener('click', ()=>{ state={seq:null,start:null,wave:null}; highlight(); render(); });

    render();
  </script>
</body>
</html>
